\section{Link Length Optimization}
This section details the optimization of the robot's link lengths to maximize jumping performance. The optimization ensures the robot can achieve sufficient jump heights for future reinforcement learning (RL) control policy training and demonstration. A grid search approach using a simplified Simscape robot model systematically explores different link length configurations.

\subsection{Problem definition}
The link lengths and initial pose critically determine the robot's jumping capability due to the passive knee spring actuation. Link lengths constrain the possible initial poses for a given jumping angle, while the pose determines spring compression and thus available potential energy. Additionally, link lengths affect the center of mass trajectory during jumps, influencing how gravitational and ground contact forces impact the robot's movement. A grid search using a simplified Simscape model (detailed in section \ref{sec:modeling}) identifies optimal link lengths.

\subsection{Problem simplification}

While the robot should jump both vertically and at angles to overcome obstacles, optimizing for angled jumps presents challenges. We want to directly compare the jumping performance of different link lengths, but it is not obvious how to place the initial pose of the robot to achieve any given jumping angle using only the passive actuation of the knee springs. This is a problem for future RL control policies.


To simplify the optimization, only the vertical jumping performance was considered, so that different link lengths can be compared directly. Vetical jumps are achieved across link lenghts by flipping the front legs, such that the legs are symmetric by the vertical axis, as shown in figure \ref{fig:link_length_optimization:flipped_legs}. In this configuration, the movement of the legs during the jump is symmetric and the robot center of mass remains in the horizontal center of the robot, such that any horizontal component of the jump is canceled out. Though this is not the asymmetric leg configuration the robot will use in practice, it provides an approximation for the jumping performance of a given link length configuration. The metric used to evaluate the jumping performance is the maximum height reached by the center of mass of the robot body, minus the maximum standing height reached by the center of mass of the robot body when the legs are fully extended and the paws are in contact with the ground.

Vertical jumps are also possible with the asymmetric configuration by horizontally shifting the paws toward the direction of the knees. However, determining the exact horizontal offset needed for arbitrary link lengths is non-trivial. For simplicity, we place the paws directly beneath the hip joints in the symmetric configuration. This approach slightly underestimates jumping performance when \(L_1 \neq L_2\) and slightly overestimates the jump height when \(L_1 = L_2\), because the asymmetric configuration would place paws offset from the hip joints for vertical jumps, which experimentation showed respectively increased and decreased the jump height. We accept this limitation as it significantly simplifies the optimization process.


\begin{figure}[h]
    \centering
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Images/link_length_optimization/asymmetric_legs.png}
        \caption{Normal asymmetric leg configuration}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.48\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Images/link_length_optimization/symmetric_legs.png}
        \caption{Symmetric leg configuration for vertical jumping}
    \end{subfigure}
    \caption{Comparison of normal and symmetric leg configurations}
    \label{fig:link_length_optimization:flipped_legs}
\end{figure}


\subsection{Initial Pose Calculation}
For each set of link lengths, an initial pose must be calculated that satisfies several constraints:

\begin{itemize}
    \item Paws must contact the ground
    \item Paws must be directly underneath their respective hip joints
    \item Knee angles must be maximized to maximize spring potential energy
    \item Knees must not penetrate the ground
    \item Knees must bend outward to avoid collision
    \item Paws must not cross each other
\end{itemize}

Due to the symmetric leg configuration, the initial pose is identical for both front and back legs, ensuring vertical jumps.

The pose calculation considers three cases based on link length ratios:

\begin{enumerate}
    \item \(L_1 = L_2\) (equal lengths)
    \item \(L_2 > L_1\) (longer lower link)
    \item \(L_1 > L_2\) (longer upper link)
\end{enumerate}

For all cases, we calculate the minimum vertical distance \(d\) from hip to paw along the vertical axis. This distance should be as small as possible to maximize the knee angle and thus spring load while satisfying the physical constraints of the robot and keeping the paws in contact with the ground. Inverse kinematics then determines the hip and knee angles, selecting the solution where knees bend outward. The distance \(d\) is calculated as follows:

\begin{itemize}
    \item For \(L_1 = L_2\): \(d = \epsilon\), where \(\epsilon\) is a small offset ensuring unique inverse kinematics solutions
    \item For \(L_2 > L_1\): \(d = L_2 - L_1 + \epsilon\), where \(\epsilon\) prevents vertical legs and ensures sufficient ground friction
    \item For \(L_1 > L_2\): \(d = \sqrt{L_1^2 - L_2^2}\), derived when \(L_2\) is horizontal (maximizing spring load) and forms a right triangle with \(L_1\) and the hip-to-paw vector
\end{itemize}

\begin{figure}[h]
    \centering
    \begin{subfigure}[b]{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Images/link_length_optimization/equal_len_pose.png}
        \caption{Equal lengths (L1=10cm, L2=10cm)}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Images/link_length_optimization/longer_L2_pose.png}
        \caption{Longer L2 (L1=15cm, L2=10cm)}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{Images/link_length_optimization/longer_L1_pose.png}
        \caption{Longer L1 (L1=15cm, L2=10cm)}
    \end{subfigure}
    \caption{Initial poses for different link length ratios}
    \label{fig:link_length_optimization:initial_poses}
\end{figure}



\subsection{Grid Search}
The grid search explores two parameters: the ratio of L2 to L1 (ranging from 0.5 to 2.0 in steps of 0.1), and the combined length L1 + L2 (ranging from 10cm to 40cm in steps of 2cm). This parameterization, shown in figure \ref{fig:link_length_optimization:search_space}, effectively focuses the search around link length ratios near 1, where preliminary tests indicated generally better performance. For each parameter combination, Simcape automatically adjusts the robot's mass based on the updated link lengths. The search was performed under both Earth (9.81 m/s²) and Mars (3.72 m/s²) gravity, with results shown in figure \ref{fig:results:grid_search_results}.

